# UI界面需求完善文档

## 介绍

基于现有的钢轨电位限制柜人机界面UI需求文档，本规范按照页面顺序补充和完善缺失的功能需求，确保UI界面能够完整支持系统的所有功能。

## 通用设计原则

所有UI控件应适应工控机触摸屏操作，具体要求：
- 所有可点击元素最小尺寸为44px×44px
- 按钮、输入框等交互元素应有足够的间距（至少8px）
- 文字大小应不小于14px以确保可读性
- 重要操作应提供视觉反馈（如按下效果、悬停效果）

## NiceUI控件统一样式规范

### 基础控件样式
- **ui.button**: 最小高度40px，圆角4px，主要按钮使用主色调#3498DB
- **ui.input**: 最小高度40px，边框1px，聚焦时显示蓝色边框
- **ui.select**: 最小高度40px，下拉箭头足够大便于触摸
- **ui.checkbox**: 复选框尺寸16px×16px，标签文字14px
- **ui.card**: 圆角6px，阴影效果，内边距12px
- **ui.expansion**: 标题栏高度40px，展开/收起图标足够大

### 数据展示控件样式
- **ui.table**: 行高最小36px，表头背景色#ECF0F1，斑马纹行
- **ui.plotly**: 工具栏按钮放大至适合触摸，图表边距充足
- **ui.icon**: 状态指示器尺寸14px，颜色遵循系统配色方案
- **ui.row**: 最小高度36px，元素间距6px

### 布局控件样式
- **ui.left_drawer**: 宽度200px，背景色#2C3E50，菜单项高度44px
- **ui.header**: 高度56px，背景色#2C3E50，文字颜色白色
- **ui.footer**: 高度36px，背景色#ECF0F1，文字颜色#2C3E50

## 需求

### 需求1：整体系统布局实现

**用户故事：** 作为用户，我需要一个清晰的整体界面布局，以便方便地访问各个功能模块。

#### 验收标准

1. WHEN 系统启动 THEN 应显示顶部栏包含设备名称、系统时间、连接状态、设置菜单、用户信息
2. WHEN 系统运行 THEN 左侧导航栏应使用NiceUI的ui.left_drawer组件，根据config.ini的界面标签配置动态显示菜单项
3. WHEN 用户点击导航菜单 THEN 主内容区域应切换到对应的页面内容
4. WHEN 系统运行 THEN 底部状态栏应显示控制板、PSCADA、服务器的详细连接信息
5. WHEN 连接状态变化 THEN 顶部和底部的状态指示器应实时更新颜色和文字

### 需求2：主接线图页面完善

**用户故事：** 作为操作员，我需要主接线图能够实时显示设备状态，以便直观监控设备运行情况。

#### 验收标准

1. WHEN 系统加载 THEN 应正确显示限制柜一次回路图.svg文件
2. WHEN 接收到模拟量数据 THEN SVG中对应的数值显示控件应实时更新
3. WHEN 开关量状态变化 THEN SVG中的开关元件应改变颜色和形状（合位/分位）
4. WHEN WebSocket连接断开 THEN 所有数值显示应变为灰色表示数据无效

### 需求2：系统状态页面完善

**用户故事：** 作为操作员，我需要查看系统各种状态位的详细信息，以便了解设备的具体运行状态。

#### 验收标准

1. WHEN 用户打开系统状态页面 THEN 应显示四个分组：系统状态、开关量输入、开关量输出、故障信息，每个分组使用ui.expansion组件
2. WHEN 接收到状态数据 THEN 应根据config.ini配置解析每个bit位，使用ui.row组件显示格式为"状态圆点 状态文字"
3. WHEN 状态位为1 THEN 应使用ui.icon显示红色圆点和逗号右边的文字（如"故障状态"），状态位为0时显示绿色圆点和逗号左边的文字（如"故障恢复"），保留位显示灰色圆点和"保留"文字
4. WHEN 状态发生变化 THEN 应实时更新对应的状态指示器颜色和文字描述
5. WHEN bit位配置为"保留,保留" THEN 应显示灰色圆点和"保留"文字

### 需求3：事件记录查询页面完善

**用户故事：** 作为操作员，我需要查询和导出事件记录，以便进行操作审计和问题追溯。

#### 验收标准

1. WHEN 用户查询事件记录 THEN 应支持按日期、事件类型筛选
2. WHEN 查询结果较多 THEN 应支持分页显示和关键词搜索
3. WHEN 用户需要导出 THEN 应支持导出为CSV格式
4. WHEN 查询过程中 THEN 应显示加载指示器
5. WHEN 查询失败 THEN 应显示错误信息

### 需求4：实时曲线页面完善

**用户故事：** 作为操作员，我需要实时曲线能够流畅显示并支持曲线选择，以便监控参数变化趋势。

#### 验收标准

1. WHEN 接收到新数据 THEN 使用ui.plotly组件的实时曲线应平滑滚动更新
2. WHEN 用户选择曲线 THEN 应支持多曲线叠加显示和单独显示
3. WHEN 曲线数据过多 THEN 应使用环形缓冲区保持性能
4. WHEN 用户打开实时曲线页面 THEN 应使用ui.card显示曲线配置栏，包含ui.checkbox曲线选择器和颜色说明
5. WHEN 用户勾选/取消曲线 THEN 应实时显示/隐藏对应的曲线

### 需求5：历史曲线页面完善

**用户故事：** 作为数据分析员，我需要查询历史曲线并支持交互操作，以便进行数据分析。

#### 验收标准

1. WHEN 用户查询历史数据 THEN 应使用ui.date和ui.select组件支持时间范围和参数选择
2. WHEN 显示历史曲线 THEN 应使用ui.plotly组件支持缩放、拖拽、数值显示等交互
3. WHEN 用户需要导出 THEN 应使用ui.button提供导出为CSV格式功能
4. WHEN 数据量较大 THEN 应支持数据采样和分批加载
5. WHEN 查询失败 THEN 应使用ui.notify显示错误信息和重试选项

### 需求6：控制参数设置页面完善

**用户故事：** 作为系统管理员，我需要安全地设置控制参数，以便调整设备运行参数。

#### 验收标准

1. WHEN 用户点击数值输入框 THEN 应弹出虚拟数字键盘
2. WHEN 用户修改参数 THEN 应进行范围验证和权限检查
3. WHEN 参数写入成功 THEN 应显示成功提示并记录操作日志
4. WHEN 参数写入失败 THEN 应显示详细错误信息

### 需求7：故障录波查询页面完善

**用户故事：** 作为维护工程师，我需要查询故障录波并以表格形式查看详细数据，以便分析故障原因。

#### 验收标准

1. WHEN 故障录波读取开始 THEN 应分批下发串口命令（每批10个寄存器）以避免数据量过大导致通信超时
2. WHEN 故障录波读取完成 THEN 应以表格形式展示300个数据点
2. WHEN 用户点击系统状态列 THEN 应弹出位状态解析对话框
3. WHEN 数据量较大 THEN 应支持虚拟滚动以保证性能
4. WHEN 用户需要导出 THEN 应支持导出为CSV格式
5. WHEN 查询进度中 THEN 应显示进度条和取消按钮

### 需求8：API状态页面完善

**用户故事：** 作为系统管理员，我需要监控API状态和数据上传情况，以便确保系统正常运行。

#### 验收标准

1. WHEN 用户查看API状态 THEN 应显示服务器连接状态和数据上传统计
2. WHEN 上传失败 THEN 应显示失败记录和重试功能
3. WHEN 用户需要手动上传 THEN 应提供手动触发上传功能
4. WHEN 连接异常 THEN 应显示详细的错误信息和诊断建议
5. WHEN 统计数据更新 THEN 应实时刷新显示

### 需求9：通道量程设置页面完善

**用户故事：** 作为技术人员，我需要设置AI通道的量程参数，以便校准传感器输入。

#### 验收标准

1. WHEN 用户打开量程设置 THEN 应显示所有AI通道的上下限设置
2. WHEN 用户修改量程 THEN 应验证下限值小于上限值
3. WHEN 量程设置成功 THEN 应更新状态列并记录操作
4. WHEN 设置失败 THEN 应显示错误原因和建议
5. WHEN 用户需要批量设置 THEN 应支持批量操作功能

### 需求10：通道校正页面完善

**用户故事：** 作为技术人员，我需要校正AI通道，以便确保模拟量采集的准确性。

#### 验收标准

1. WHEN 用户打开校正页面 THEN 应显示所有AI通道的三点校正值
2. WHEN 用户启动校正向导 THEN 应提供分步校正指导
3. WHEN 校正过程中 THEN 应显示当前ADC读数和校正进度
4. WHEN 校正完成 THEN 应自动写入校正值并验证结果
5. WHEN 校正失败 THEN 应提供重试选项和错误说明

### 需求11：用户登录和权限管理

**用户故事：** 作为系统管理员，我需要用户登录界面和权限管理功能，以便控制不同用户的操作权限。

#### 验收标准

1. WHEN 用户访问系统 THEN 应显示登录界面要求输入用户名和密码
2. WHEN 用户登录成功 THEN 系统应根据用户权限类型显示相应的界面元素
3. WHEN 管理员用户登录 THEN 应提供用户管理界面支持增删改查用户
4. WHEN 用户权限不足 THEN 系统应禁用相关按钮并显示权限提示
5. WHEN 用户会话过期 THEN 系统应自动跳转到登录页面

### 需求12：通用组件完善

**用户故事：** 作为开发人员，我需要完善的通用组件，以便提供一致的用户体验。

#### 验收标准

1. WHEN 用户点击数值输入框 THEN 应弹出虚拟数字键盘支持正负号切换
2. WHEN 需要确认操作 THEN 应显示确认对话框防止误操作
3. WHEN 系统处理中 THEN 应显示加载指示器
4. WHEN 操作成功或失败 THEN 应显示相应的提示信息
5. WHEN 用户需要帮助 THEN 应提供操作说明和错误处理建议

